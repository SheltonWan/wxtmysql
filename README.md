# WXT MySQL - 线程安全的 MySQL 数据库服务

一个功能完整、线程安全的 Dart MySQL 数据库连接服务包。



## 🔥 主要职责
- **数据库连接管理**：提供 MySQL 数据库的连接建立、维护和关闭
- **配置管理**：从环境变量和 .env 文件加载数据库配置
- **SQL 操作封装**：封装常见的 CRUD 操作（查询、插入、更新、删除）
- **事务管理**：提供线程安全的事务开始、提交、回滚功能
- **连接池管理**：维护单一连接实例，避免重复连接
- **错误处理和日志记录**：统一的异常处理和操作日志

## � 核心功能
- **单例模式**：确保全局只有一个数据库服务实例
- **线程安全**：使用 Lock 机制保护所有并发操作
- **连接复用**：智能检测现有连接状态，避免不必要的重连
- **配置灵活性**：支持多种配置来源（.env 文件、系统环境变量、默认值）
- **事务支持**：提供手动和自动事务管理，防止嵌套事务
- **状态监控**：实时连接状态和事务状态检查
- **维护功能**：包含连接测试、版本查询、过期会话清理等工具方法

## ⭐ 优点分析

### 1. 并发安全设计
- 使用 `synchronized` 包提供的 Lock 机制
- 连接操作完全线程安全
- 事务串行化执行，避免数据竞争

### 2. 设计模式运用得当
- 采用单例模式，避免多个实例造成资源浪费
- 连接复用机制，提高性能

### 3. 配置管理灵活
- 支持多级配置：.env 文件 → 系统环境变量 → 默认值
- 使用 `EnvKeys` 类集中管理配置键名，避免硬编码

### 4. 完整的数据库操作封装
- 提供了 CRUD 的完整实现
- 事务支持完整（手动控制 + 自动回滚）
- 返回值有意义（插入返回ID，更新/删除返回影响行数）

### 5. 错误处理和日志记录
- 完善的异常捕获和重新抛出
- 详细的日志记录，便于调试和监控
- 不同级别的日志（info、warning、severe、fine）

### 6. 连接健康检查
- 连接前检测现有连接是否可用
- 提供 `testConnection()` 方法主动检测
- 连接失败时自动重连机制